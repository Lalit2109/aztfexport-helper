# Azure Subscriptions Configuration
# Configure your 35 subscriptions here

# Subscription Export Control
# By default, ALL subscriptions are exported unless:
#   - export_enabled: false is set in the subscription config, OR
#   - subscription ID is listed in exclude_subscriptions below
# This makes it easier to manage 35+ subscriptions by only listing what to exclude
exclude_subscriptions:
  # List subscription IDs to exclude from export
  # Example:
  # - "subscription-id-to-exclude-1"
  # - "subscription-id-to-exclude-2"

# Global exclusions (applied to all subscriptions)
# These resource groups are excluded from export across all subscriptions
# Wildcard patterns are supported (* and ?)
global_excludes:
  resource_groups:
    # Azure-managed/system resource groups (wildcard supported)
    - "Built-in-identity-rg"
    - "networkwatcherRG"
    - "NetworkWatcherRG_*"        # Network Watcher (all regions)
    - "AzureBackupRG_*"           # Azure Backup
    - "AzureSiteRecoveryRG_*"     # Azure Site Recovery
    - "MC_*"                      # AKS managed clusters
    - "azure-arc"                 # Azure Arc
    - "DefaultResourceGroup-*"    # Default resource groups
    # Add more patterns as needed
    # - "rg-system-*"
    # - "rg-azure-*"

# Logging configuration
logging:
  # Log level: DEBUG, INFO, or ERROR
  # DEBUG: Shows all messages including detailed debug information
  # INFO: Shows informational messages, warnings, and errors (default)
  # ERROR: Shows only error messages
  # Can also be set via environment variable: LOG_LEVEL=DEBUG
  level: INFO

subscriptions:
  - id: "subscription-id-1"
    name: "Production Subscription 1"
    environment: "prod"
    # export_enabled: true  # Optional: set to false to exclude this subscription
    # Repository configuration (optional)
    # repo_name: "terraform-prod-sub-1"  # Repository name (will be created if doesn't exist)
    # repo_url: "https://dev.azure.com/org/project/_git/terraform-prod-sub-1"  # Full repository URL
    # branch: "main"  # Override default branch
    
  - id: "subscription-id-2"
    name: "Development Subscription 1"
    environment: "dev"
    # export_enabled: true  # Optional: set to false to exclude this subscription
    # repo_name: "terraform-dev-sub-1"
    # repo_url: "https://dev.azure.com/org/project/_git/terraform-dev-sub-1"
    # branch: "develop"  # Different branch for dev
    
  # Add remaining 33 subscriptions here
  # Note: By default, all subscriptions are exported unless:
  #   - export_enabled: false is set, OR
  #   - subscription ID is in exclude_subscriptions list above
  # Template:
  # - id: "subscription-id-X"
  #   name: "Subscription Name"
  #   environment: "prod|dev|staging"
  #   # export_enabled: true|false  # Optional, defaults to true

# aztfexport configuration
aztfexport:
  # Resource types to export (empty = export all)
  # Example: ["Microsoft.Compute/virtualMachines", "Microsoft.Network/virtualNetworks"]
  resource_types: []
  
  # Resource groups to exclude from export (subscription-specific)
  # Supports exact match and wildcard patterns (* and ?)
  # These are in addition to global_excludes above
  # Example:
  # exclude_resource_groups:
  #   - "rg-exclude-this"        # Exact match
  #   - "rg-test-*"              # Wildcard pattern
  #   - "rg-temp-resources"
  exclude_resource_groups: []
  
  # Resources to exclude (by ID pattern)
  # Example: ["/subscriptions/xxx/resourceGroups/xxx/providers/Microsoft.xxx/xxx"]
  exclude_resources: []
  
  # Resource types to exclude using Azure Resource Graph query mode
  # When specified, aztfexport will use query mode to exclude these resource types
  # Example: ["Microsoft.Insights/components", "Microsoft.OperationalInsights/workspaces/savedSearches"]
  # Note: This uses Azure Resource Graph queries (more efficient than --exclude flags)
  # For nested resources, use the full path: "Microsoft.OperationalInsights/workspaces/savedSearches"
  exclude_resource_types: []
  
  # Custom Azure Resource Graph query (optional, overrides exclude_resource_types)
  # If provided, this query will be used directly in aztfexport query mode
  # Example: "type != 'Microsoft.OperationalInsights/workspaces/savedSearches' and type != 'Microsoft.Insights/components'"
  # Leave empty to auto-generate query from exclude_resource_types
  query: null
  
  # Additional aztfexport flags
  # Example: ["--parallelism", "5"]
  additional_flags: []

# Azure DevOps configuration
azure_devops:
  organization: "your-org"
  project: "your-project"
  # Service connection name for Azure authentication (configured in pipeline variable group)
  service_connection: "Azure-ServiceConnection"

# Git configuration
git:
  # Whether to push exported code to git repositories
  # Can be overridden via PUSH_TO_REPOS environment variable
  push_to_repos: false
  
  # Default branch name for git repositories
  # Can be overridden per subscription
  branch: "main"

# Note: This tool uses Azure CLI (az) for all Azure operations
# Azure CLI handles SSL certificates automatically, so no SSL configuration needed
  
# Output configuration
output:
  # Base directory for exports (relative to workspace or absolute path)
  # Folder structure will be: {base_dir}/{subscription-name}/{resource-group-name}/
  # Default: "./exports"
  base_dir: "./exports"
  
  # Whether to create resource group subfolders under subscription folder
  # If true: {base_dir}/{subscription-name}/{resource-group-name}/
  # If false: {base_dir}/{subscription-name}/ (all resources in subscription folder)
  # Default: true
  create_rg_folders: true
  

